---
sidebar_position: 1
sidebar_label: Optimizing delivery
title: Optimizing media delivery
description: Learn how to optimize delivery of segments to a CDN
hide_title: true
keywords:
  - momento
  - mediastore
  - origin
  - streaming
  - live
  - elemental
  - serverless
  - performance
---

# セグメント配信の最適化

ユーザーに高い[ゼロ・バッファ・レート](/mediastore/core-concepts/zero-buffer-rate)でシームレスなストリーミング体験を提供することは、あらゆるストリーミング・プロバイダーの基礎となる柱です。視聴者の期待が高まり、コンテンツがより複雑になるにつれ、バッファリングを回避し、品質を維持し、さまざまなレベルのトラフィックに対応するためには、高速で信頼性の高い配信を提供することが不可欠です。**Momento MediaStore**は、[メディアセグメント](/mediastore/core-concepts/segments)の保存と検索の最適化において重要な役割を果たし、低遅延アクセス、CDN統合、スケーラブルなアーキテクチャにより、より高速で信頼性の高い配信を可能にします。

しかし、Momento MediaStoreは、それだけですべてを行うことはできません。これらの機能を最大限に活用できるように、Momento MediaStoreの上に構築するのはあなた次第です。以下の最適化戦略で構築することで、それが可能になります：

* **バッファリングイベントの最小化** - 視聴者は即時再生を期待しています。遅延やバッファリングは離脱につながります。
* **アダプティブ・ビットレート・ストリーミング（ABR）をサポート** - 異なる品質レベル間の高速でシームレスな切り替えは、バッファリングや品質低下を防ぎます。
* **視聴者の維持** - 最適化された配信は混乱を減らし、視聴者のリテンション向上につながります。

## content delivery networks (CDNs) の利用

CDNは、視聴者の近くにコンテンツをキャッシュすることで、メディア配信を最適化するために非常に重要です。**Momento MediaStore**と統合すると、CDNはユーザーリクエストの大部分を処理し、遅延を減らしてスムーズな再生を保証します。CDNをワークフローに組み込むことで、オリジンへの直接のコールがなくなり、視聴者へのレイテンシーが減少します。キャッシュされたセグメントはエンドユーザーに地理的に近く、可能な限り最速の配信を実現します。

CDNはまた、**リクエストコラプシング**のようなテクニックを実行します。これは、キャッシュミスのセグメントに対するリクエストをキューに入れ、コンテンツが[オリジン](/mediastore/core-concepts/origin)から正常に取得されると、それらに応答します。これにより、オリジンへのリクエストを最小限に抑え、負担を軽減し、最終的にユーザーに高速なエクスペリエンスを提供します。

Momento MediaStoreの低レイテンシーオリジンとCDNのキャッシングおよびリクエスト最適化技術を組み合わせることで、コンテンツをより速く、より安全に、より確実にユーザーに配信できます。

## 短いセグメントを保存する

通常2～4秒の短い[メディアセグメント](/mediastore/core-concepts/segments)を保存することで、プレーヤーがより小さなデータチャンクをより迅速に取得できるようになり、配信速度が大幅に向上します。これは特に[ABR（アダプティブ・ビットレート・ストリーミング）](/mediastore/performance/adaptive-bitrates/how-it-works)にとって有益であり、プレイヤーはネットワーク状況の変化に応じて品質レベルをシームレスに切り替えることができ、バッファリングのリスクを軽減することができます。また、セグメントを短くすることで、ライブストリーミングをよりリアルタイムに近づけ、[glass-to-glass latency](/mediastore/streaming/live-streaming/glass-to-glass-latency)を最小限に抑えることができます。

しかし、短いセグメントにはいくつかのトレードオフがあります。CDNとオリジンへのHTTPリクエストの数が増えるため、サーバーの負荷とCDNのオーバーヘッドがわずかに増加する可能性があります。リクエストの頻度が高くなるということは、**ルックアヘッドバッファ**が小さくなるということでもあり、ネットワークの混乱から回復する時間が少なくなります。さらに、セグメントへのリクエストが失敗した場合、長いセグメントに比べて再生が中断される頻度が高くなります。このような課題はありますが、よりスムーズな再生とバッファリングの削減によるパフォーマンスの向上により、短いセグメントが好まれることが多くなっています。

## アダプティブ・ビットレート・ストリーミングのトランジションの改善

アダプティブ・ビットレート・ストリーミング（ABR）により、プレーヤはネットワークの状況に応じてビデオ品質レベルを動的に切り替え、よりスムーズな再生を実現します。このような切り替えを最適化するには、1080p、720p、480p などの複数の解像度を Momento MediaStore に保存し、必要なときにプレーヤーが適切な品質レベルにアクセスできるようにすることが不可欠です。

### マニフェストとキーネーミングの最適化

よく構造化されたマニフェスト ファイルと一貫したキー ネーミングは、高速でシームレスなトランジションの鍵です。最適化されたマスター マニフェストには、異なるビットレートが明確にリストされ、各品質レベルに関連するプレイリストが示されています。

```plaintext
#EXTM3U
#EXT-X-STREAM-INF:BANDWIDTH=5000000,RESOLUTION=1920x1080
livestreams/1080p/playlist.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=3000000,RESOLUTION=1280x720
livestreams/720p/playlist.m3u8
```

各プレイリストは、より速く検索するために、よく名前が付けられたセグメントを参照し、**予測可能で一貫性のあるキー名**を使用する必要があります。

```plaintext
livestreams/1080p/segment1.ts
livestreams/720p/segment1.ts
```

これにより、CDNは効率的にセグメントをキャッシュして提供することができ、結果的に品質レベル間の移行が速くなります。一方、一貫性のないキー名は、キャッシュやプリフェッチの効果を低下させ、検索速度を低下させます。

### 考察とトレードオフ

ABRのトランジションを最適化すると視聴体験が向上するが、以下の点を考慮することが重要です：

* **ストレージ・オーバーヘッド** - 複数のバージョンのコンテンツを保存すると、ストレージ要件が増加すします
* **キャッシュの更新** - コンテンツやビットレートの変更に伴い、より頻繁なキャッシュの更新が必要になる場合があります
* **急激な変動への対応** - 急なネットワーク変更によって、次のセグメントがキャッシュされなかったり、十分な速さで取得されなかったりした場合でも、短時間の中断が発生することがあります。

このようなトレードオフにもかかわらず、マニフェストとキーネーミングを最適化することで、ABRのトランジションがより速くスムーズになり、バッファリングが最小限に抑えられ、ストリーミング体験の全体的な品質が向上します。

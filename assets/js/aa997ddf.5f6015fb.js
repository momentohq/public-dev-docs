"use strict";(globalThis.webpackChunkmomento_docs=globalThis.webpackChunkmomento_docs||[]).push([[9964],{28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var i=n(96540);const s={},a=i.createContext(s);function o(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:t},e.children)}},86806:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"media-storage/entitlements/about","title":"Entitlements","description":"Learn about media entitlements and how to use them with Momento Media Storage","source":"@site/docs/media-storage/entitlements/about.md","sourceDirName":"media-storage/entitlements","slug":"/media-storage/entitlements/about","permalink":"/media-storage/entitlements/about","draft":false,"unlisted":false,"editUrl":"https://github.com/momentohq/public-dev-docs/tree/main/docs/media-storage/entitlements/about.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"About","title":"Entitlements","description":"Learn about media entitlements and how to use them with Momento Media Storage","hide_title":true,"keywords":["momento","media storage","zero buffer rate","zbr","streaming","live","elemental","serverless","metrics","entitlements"]},"sidebar":"mediastorageSidebar","previous":{"title":"Entitlements"},"next":{"title":"Real-time updates","permalink":"/media-storage/entitlements/real-time-updates"}}');var s=n(74848),a=n(28453);const o={sidebar_position:1,sidebar_label:"About",title:"Entitlements",description:"Learn about media entitlements and how to use them with Momento Media Storage",hide_title:!0,keywords:["momento","media storage","zero buffer rate","zbr","streaming","live","elemental","serverless","metrics","entitlements"]},r="Entitlements in Momento Media Storage",c={},l=[{value:"What are entitlements?",id:"what-are-entitlements",level:2},{value:"Types of access restriction",id:"types-of-access-restriction",level:2},{value:"Subscription-based",id:"subscription-based",level:3},{value:"Geo-restrictions",id:"geo-restrictions",level:3},{value:"Device restrictions",id:"device-restrictions",level:3},{value:"Time-sensitive access",id:"time-sensitive-access",level:3},{value:"Efficiently managing entitlements with Momento Media Storage",id:"efficiently-managing-entitlements-with-momento-media-storage",level:2},{value:"Use Momento Cache for entitlement storage",id:"use-momento-cache-for-entitlement-storage",level:2},{value:"Example entitlement object",id:"example-entitlement-object",level:3},{value:"Storing data as a dictionary",id:"storing-data-as-a-dictionary",level:3},{value:"Storing data as a blob",id:"storing-data-as-a-blob",level:3},{value:"Restricting access with Momento auth tokens",id:"restricting-access-with-momento-auth-tokens",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"entitlements-in-momento-media-storage",children:"Entitlements in Momento Media Storage"})}),"\n",(0,s.jsxs)(t.p,{children:["Entitlements are the authorization mechanisms that control what content users can access based on their subscriptions, region, or viewing rights. Managing entitlements efficiently provides a ",(0,s.jsx)(t.strong,{children:"secure"}),", ",(0,s.jsx)(t.strong,{children:"personalized"}),", and ",(0,s.jsx)(t.strong,{children:"authorized"})," delivery of content. Momento enables you to implement low-latency, scalable patterns that manage, distribute, and enforce entitlements dynamically in real-time, ensuring the smooth delivery of content while safeguarding rights and access."]}),"\n",(0,s.jsx)(t.h2,{id:"what-are-entitlements",children:"What are entitlements?"}),"\n",(0,s.jsx)(t.p,{children:"Entitlements define the permissions and rights a user has to view specific media content. These permissions can be based on:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Subscription tiers"})," (premium vs. free)"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Geographic location"})," (regional restrictions)"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"User identity"})," (logged-in vs. anonymous users)"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Device limitations"})," (access on mobile devices only)"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Time-bound access"})," (rental or limited-time access to specific content)"]}),"\n"]}),"\n",(0,s.jsx)(t.admonition,{type:"info",children:(0,s.jsxs)(t.p,{children:["Entitlements answer the critical question: ",(0,s.jsx)(t.em,{children:"\u201cCan this user access this content, at this time, on this device?\u201d"})]})}),"\n",(0,s.jsx)(t.h2,{id:"types-of-access-restriction",children:"Types of access restriction"}),"\n",(0,s.jsx)(t.p,{children:"Entitlements can be based on a number of factors depending on use case. Here are some common examples."}),"\n",(0,s.jsx)(t.h3,{id:"subscription-based",children:"Subscription-based"}),"\n",(0,s.jsx)(t.p,{children:"A user\u2019s subscription level dictates which video libraries or specific titles they can stream. For example, only premium users can access 4K streams or exclusive content."}),"\n",(0,s.jsx)(t.h3,{id:"geo-restrictions",children:"Geo-restrictions"}),"\n",(0,s.jsx)(t.p,{children:"Content is restricted based on the viewer's geographic location due to licensing agreements. For example, certain content is available in the US but blocked in Europe."}),"\n",(0,s.jsx)(t.h3,{id:"device-restrictions",children:"Device restrictions"}),"\n",(0,s.jsx)(t.p,{children:"Certain content might be available only on specific devices. For example, a media service could provide mobile-only offers or VR-specific experiences."}),"\n",(0,s.jsx)(t.h3,{id:"time-sensitive-access",children:"Time-sensitive access"}),"\n",(0,s.jsx)(t.p,{children:"Some content is available only for a limited time, such as live events or pay-per-view offerings that expire after viewing."}),"\n",(0,s.jsx)(t.h2,{id:"efficiently-managing-entitlements-with-momento-media-storage",children:"Efficiently managing entitlements with Momento Media Storage"}),"\n",(0,s.jsx)(t.p,{children:"Entitlement checks are often resource-intensive, especially when involving complex logic that depends on user data, location, device, and content metadata. Traditional approaches often result in high database loads and latenc With Momento, you can dramatically reduce this overhead by caching entitlement data and handling real-time authorization checks with minimal delay."}),"\n",(0,s.jsx)(t.h2,{id:"use-momento-cache-for-entitlement-storage",children:"Use Momento Cache for entitlement storage"}),"\n",(0,s.jsx)(t.p,{children:"Momento Cache is an ultra-low latency cache accessible from anywhere, including browsers, media servers, and auth mechanisms. After the initial entitlement calculation for a user is performed, you can store it in the cache to provide the fastest possible experience for your viewers."}),"\n",(0,s.jsx)(t.p,{children:"Not only is Momento Cache blazingly fast, but it also automatically scales to millions of transactions per second (TPS), leaving you without the burden of infrastructure management during stressful high-demand events. This immediate elasticity prevents traffic bottlenecks on mission-critical components of your application."}),"\n",(0,s.jsx)(t.p,{children:"With several data types at your disposal, Momento Cache offers a flexible way to store and fetch entitlement data for access control."}),"\n",(0,s.jsx)(t.h3,{id:"example-entitlement-object",children:"Example entitlement object"}),"\n",(0,s.jsx)(t.p,{children:"Consider the example entitlement object below."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:'{\n  "subscription_level": "premium",\n  "region": "US",\n  "device_restriction": "none",\n  "valid_from": "2024-10-01T00:00:00Z",\n  "valid_until": "2024-12-31T23:59:59Z",\n  "allowed_content": ["movie_id_123", "series_id_456"]\n}\n\n'})}),"\n",(0,s.jsx)(t.p,{children:"This object contains information about a user that can be used to check access in a number of ways. Storing this data efficiently depends on how you evaluate entitlements at runtime."}),"\n",(0,s.jsx)(t.h3,{id:"storing-data-as-a-dictionary",children:"Storing data as a dictionary"}),"\n",(0,s.jsxs)(t.p,{children:["A ",(0,s.jsx)(t.a,{href:"/cache/develop/basics/datatypes#dictionaries",children:"cache dictionary"})," allows you to store individual string and number properties and fetch them either all at once or as a subset. This provides a granular way to check entitlements if specific content is strictly region-based, tiered, etc\u2026"]}),"\n",(0,s.jsx)(t.p,{children:"Dictionaries can store an entire JSON object with a single command, providing a quick and easy way to cache entitlements after calculation. Take the example below that stores the entire entitlements object on the auth server, then evaluates access based on subscription tier on the client in the media player."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"// Auth server\nconst entitlements = await calculateEntitlements(userId);\nawait cacheClient.dictionarySetFields(NAMESPACE, userId, entitlements);\n\n// Client side media player\nlet subscriptionLevel = 'free';\nconst subscriptionResponse = await cacheClient.dictionaryGetField(NAMESPACE, userId, 'subscription_level');\nif(subscriptionResponse.type == CacheDictionaryGetFieldResponse.Hit) {\n  subscriptionLevel = subscriptionResponse.value();\n}\n\nconst canView = subscriptionLevel === 'premium';\nreturn canView;\n"})}),"\n",(0,s.jsxs)(t.p,{children:["In this example, the media player is fetching only the ",(0,s.jsx)(t.code,{children:"subscription_level"})," property from the entitlements cache item, minimizing the amount of data loaded in the player."]}),"\n",(0,s.jsxs)(t.p,{children:["If the entitlement evaluation is more involved and requires the entire object, it can be fetched in a single ",(0,s.jsx)(t.a,{href:"/cache/develop/api-reference/dictionary-collections#dictionaryfetch",children:"dictionary fetch command"})," instead."]}),"\n",(0,s.jsx)(t.h3,{id:"storing-data-as-a-blob",children:"Storing data as a blob"}),"\n",(0,s.jsxs)(t.p,{children:["An alternative to storing entitlements as a cache dictionary is storing it as a blob in a ",(0,s.jsx)(t.em,{children:"scalar"})," cache item. This foundational object storage method will store data either as binary data or as a string."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"// Auth server\nconst entitlements = await calculateEntitlements(userId);\nawait cacheClient.set(NAMESPACE, userId, entitlements);\n\n// Client side media player\nlet entitlements;\nconst entitlementsResponse = await cacheClient.get(NAMESPACE, userId);\nif(entitlementsResponse.type == CacheGet.Hit) {\n  entitlements = entitlementsResponse.value():\n}\n\nconst canView = await evaluate(entitlements);\nreturn canView;\n"})}),"\n",(0,s.jsx)(t.p,{children:"This example fetches the entire entitlements object out of the cache and evaluates it with more meaningful calculations based on your specific business requirements."}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsxs)(t.p,{children:["Accessing scalar values can be done via the ",(0,s.jsx)(t.a,{href:"/cache/develop/api-reference/http-api",children:"Momento HTTP API"})," or through ",(0,s.jsx)(t.a,{href:"/platform/sdks",children:"one of the SDKs"}),", granting cache data access to anything with internet access. Cache dictionaries are only accessible through the Momento SDK."]})}),"\n",(0,s.jsx)(t.h2,{id:"restricting-access-with-momento-auth-tokens",children:"Restricting access with Momento auth tokens"}),"\n",(0,s.jsxs)(t.p,{children:["Another way to approach entitlements is by embedding access to content directly in ",(0,s.jsx)(t.a,{href:"/cache/develop/authentication/tokens",children:"session tokens"}),". After your entitlements calculation is complete and you have a known list of media a user can access, you can grant explicit access to the content via a short-lived token."]}),"\n",(0,s.jsxs)(t.p,{children:["If Momento Media Storage is being used as the ",(0,s.jsx)(t.a,{href:"/media-storage/core-concepts/origin",children:"media origin"}),", fine-grained access control can be used to restrict access to content upon request."]}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsx)(t.p,{children:"When using a CDN to serve media, this approach does not work. This solution is for use cases that fetch content directly from Momento. Momento\u2019s Intelligent Gateway evaluates every incoming request against the provided auth token. A CDN would not forward a particular viewer's token to Momento, which would leave this approach ineffective."})}),"\n",(0,s.jsx)(t.p,{children:"Imagine your content is stored in Momento Media Storage with the following structure:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"/{ContentName}/playlist.m3u8\n/{ContentName}/1080p/playlist.m3u8\n/{ContentName}/1080p/segment1.ts\n/{ContentName}/720p/playlist.m3u8\n/{ContentName}/720p/segment1.ts\n"})}),"\n",(0,s.jsxs)(t.p,{children:["This structure implies an ",(0,s.jsx)(t.a,{href:"/media-storage/performance/adaptive-bitrates/hls",children:"HLS"})," encoded video with multiple resolutions and bitrates. All keys for this particular piece of media are prefixed with the content identifier. When creating a short-lived token, you can grant read only access to all keys for that piece of content."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"const scope = {\n  permissions: [ {\n    role: 'readonly',\n    cache: 'media',\n    item: {\n      keyPrefix: `/${ContentName}/`\n    }\n  }]\n};\n\nconst token = authClient.generateDisposableToken(scope, ExpiresIn.hours(1), { tokenId: userId }):\n"})}),"\n",(0,s.jsxs)(t.p,{children:["This example creates a permission scope that grants read only access to every key beginning with the name of the content and creates a token with the Momento AuthClient valid for 1 hour with the user's id embedded in it for implicit identification. The token can then be served down the the media player to use to fetch the video directly from the origin. If the player attempts to load a video not explicitly granted in the token, it will receive an ",(0,s.jsx)(t.code,{children:"Unauthorized"})," response."]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);
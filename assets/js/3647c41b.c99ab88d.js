"use strict";(self.webpackChunkmomento_docs=self.webpackChunkmomento_docs||[]).push([[3979],{581:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>d});var i=o(74848),r=o(28453);const t={sidebar_position:15,sidebar_label:"Running as a sidecar",title:"Sidecar Configuration",description:"Learn how to configure Momento Proxy as a sidecar in your container environment."},a="Running Momento Proxy as a sidecar with Memcached",c={id:"cache/proxy/configuration/sidecar",title:"Sidecar Configuration",description:"Learn how to configure Momento Proxy as a sidecar in your container environment.",source:"@site/docs/cache/proxy/configuration/sidecar.md",sourceDirName:"cache/proxy/configuration",slug:"/cache/proxy/configuration/sidecar",permalink:"/cache/proxy/configuration/sidecar",draft:!1,unlisted:!1,editUrl:"https://github.com/momentohq/public-dev-docs/tree/main/docs/cache/proxy/configuration/sidecar.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15,sidebar_label:"Running as a sidecar",title:"Sidecar Configuration",description:"Learn how to configure Momento Proxy as a sidecar in your container environment."},sidebar:"cacheSidebar",previous:{title:"Configuration",permalink:"/cache/proxy/configuration/"},next:{title:"Example",permalink:"/cache/proxy/configuration/example"}},s={},d=[{value:"What is a sidecar?",id:"what-is-a-sidecar",level:2},{value:"Running with Docker Compose",id:"running-with-docker-compose",level:2},{value:"Running with Kubernetes",id:"running-with-kubernetes",level:2},{value:"Calling the sidecar in your code",id:"calling-the-sidecar-in-your-code",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"running-momento-proxy-as-a-sidecar-with-memcached",children:"Running Momento Proxy as a sidecar with Memcached"})}),"\n",(0,i.jsxs)(n.p,{children:["Running Momento Proxy as a sidecar is the best way to ensure low-latency performance in production environments. By running the proxy with your application-meaning in the same service group or pod-you avoid the extra network hop and can access Momento over ",(0,i.jsx)(n.code,{children:"localhost"})," for optimal speed."]}),"\n",(0,i.jsx)(n.h2,{id:"what-is-a-sidecar",children:"What is a sidecar?"}),"\n",(0,i.jsxs)(n.p,{children:["A sidecar is a container that runs alongside your main application within the same service group (in Docker Compose) or pod (in Kubernetes). It shares the same network namespace, so your application can communicate with the proxy over ",(0,i.jsx)(n.code,{children:"localhost"})," with no additional routing."]}),"\n",(0,i.jsxs)(n.p,{children:["This setup is for performance-critical environments where ",(0,i.jsx)(n.em,{children:"every millisecond counts"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"running-with-docker-compose",children:"Running with Docker Compose"}),"\n",(0,i.jsx)(n.p,{children:"Below is how you can configure Momento Proxy to run as a sidecar using Docker Compose:"}),"\n",(0,i.jsx)(n.admonition,{title:"Note",type:"info",children:(0,i.jsxs)(n.p,{children:["In Docker Compose, each container runs in its own network namespace. That means localhost refers to the container itself, not the proxy. Instead, your application should connect to the proxy using the service name defined in the Compose file\u2014like ",(0,i.jsx)(n.code,{children:"proxy:11211"})," for Memcached."]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'version: \'3.8\'\nservices:\n  app:\n    image: my-app-image\n    depends_on:\n      - proxy\n    environment:\n      - MEMCACHED_HOST=proxy\n  proxy:\n    image: gomomento/momento-proxy\n    ports:\n      - "11211:11211"\n      - "9999:9999"\n    environment:\n      - MOMENTO_AUTHENTICATION=your_api_key\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Your application can connect to ",(0,i.jsx)(n.code,{children:"proxy:11211"})," for to proxy your Memcached calls to Momento!"]}),"\n",(0,i.jsx)(n.h2,{id:"running-with-kubernetes",children:"Running with Kubernetes"}),"\n",(0,i.jsx)(n.p,{children:"Here's how to configure Momento Proxy as a sidecar container within a Kubernetes Pod:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: my-app-pod\nspec:\n  containers:\n    - name: app\n      image: my-app-image\n      ports:\n        - containerPort: 8080\n    - name: momento-proxy\n      image: gomomento/momento-proxy\n      env:\n        - name: MOMENTO_AUTHENTICATION\n          valueFrom:\n            secretKeyRef:\n              name: momento-auth\n              key: token\n      ports:\n        - containerPort: 11211\n        - containerPort: 9999\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This allows your application to send Memcached-compatible commands to ",(0,i.jsx)(n.code,{children:"localhost:11211"})," and have them translated and forwarded to Momento Cache."]}),"\n",(0,i.jsx)(n.h2,{id:"calling-the-sidecar-in-your-code",children:"Calling the sidecar in your code"}),"\n",(0,i.jsxs)(n.p,{children:["Once the proxy is running as a sidecar, all you need to do is point your existing cache client to ",(0,i.jsx)(n.code,{children:"localhost"})," (or ",(0,i.jsx)(n.code,{children:"proxy"})," if using Docker Compose). Here's a simple example in Java using the ",(0,i.jsx)(n.a,{href:"https://github.com/couchbase/spymemcached",children:"SpyMemcached"})," client:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'import net.spy.memcached.MemcachedClient;\nimport java.net.InetSocketAddress;\n\npublic class App {\n    public static void main(String[] args) throws Exception {\n        // If running in Kubernetes, use localhost. In Docker Compose, use "proxy".\n        MemcachedClient client = new MemcachedClient(\n            new InetSocketAddress("localhost", 11211)\n        );\n\n        client.set("foo", 3600, "bar").get();\n        Object value = client.get("foo");\n\n        System.out.println("Value for key \'foo\': " + value);\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\ud83d\udca1 With this, all your ",(0,i.jsx)(n.code,{children:"get"})," and ",(0,i.jsx)(n.code,{children:"set"})," calls to Memcached are now being proxied to Momento Cache!"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,n,o)=>{o.d(n,{R:()=>a,x:()=>c});var i=o(96540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);